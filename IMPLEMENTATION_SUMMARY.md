# ๐ ููุฎุต ุชูููุฐ ูุธุงู ุงูุฅุญุงูุงุช (Referral System)

## โ ุชู ุฅูุฌุงุฒู

### 1. **ูุงุนุฏุฉ ุงูุจูุงูุงุช** โ
- [x] ุชุญุฏูุซ ุฌุฏูู `users` ุจุฅุถุงูุฉ:
  - `referral_code` (ูุฑูุฏ)
  - `referred_by` (nullable)
- [x] ุฅูุดุงุก ุฌุฏูู `referrals` ูุน ุงูุญููู:
  - `id`, `referrer_id`, `referred_user_id`
  - `status` (pending/confirmed/rewarded)
  - `reward_given`, `created_at`, `confirmed_at`

๐ **ุงูููู**: [src/lib/schema.ts](./src/lib/schema.ts)

---

### 2. **API Routes** โ
ุชู ุฅูุดุงุก 4 endpoints ุฑุฆูุณูุฉ:

| Endpoint | ุงูุทุฑููุฉ | ุงููุตู |
|----------|---------|-------|
| `/api/referral/me` | GET | ุฌูุจ ุจูุงูุงุช ุงูุฅุญุงูุงุช ุงูุดุฎุตูุฉ |
| `/api/referral/stats` | GET | ุฌูุจ ุงูุฅุญุตุงุฆูุงุช ุงููุงููุฉ |
| `/api/referral/track` | POST | ุชุชุจุน ุฅุญุงูุฉ ุฌุฏูุฏุฉ |
| `/api/referral/reward` | POST | ูุนุงูุฌุฉ ุงูููุงูุฃุฉ |

๐ **ุงูููู**: [api/routes/referral.ts](./api/routes/referral.ts)

---

### 3. **Backend Services** โ

#### ุงูุฏูุงู ุงููุชุงุญุฉ:
- โ `generateReferralCode()` - ุชูููุฏ ููุฏ ูุฑูุฏ
- โ `validateReferralCode()` - ุงูุชุญูู ูู ุตุญุฉ ุงูููุฏ
- โ `canBeReferred()` - ุงูุชุญูู ูู ุฅููุงููุฉ ุงูุฅุญุงูุฉ
- โ `processReferralReward()` - ูุนุงูุฌุฉ ุงูููุงูุฃุฉ
- โ `getUserReferralStats()` - ุฌูุจ ุงูุฅุญุตุงุฆูุงุช

๐ **ุงูููู**: [api/services/referralBackendService.ts](./api/services/referralBackendService.ts)

---

### 4. **Frontend Services** โ

#### ุงูุฏูุงู ุงููุชุงุญุฉ:
- โ `getReferralData()` - ุฌูุจ ุจูุงูุงุช ุงูุฅุญุงูุงุช
- โ `getReferralStats()` - ุฌูุจ ุงูุฅุญุตุงุฆูุงุช
- โ `trackReferral()` - ุชุชุจุน ุฅุญุงูุฉ
- โ `processReferralReward()` - ูุนุงูุฌุฉ ุงูููุงูุฃุฉ
- โ `getReferralCodeFromURL()` - ุงุณุชุฎุฑุงุฌ ุงูููุฏ ูู URL
- โ `copyReferralLink()` - ูุณุฎ ุงูุฑุงุจุท
- โ `shareReferralLink()` - ูุดุงุฑูุฉ ุงูุฑุงุจุท

๐ **ุงูููู**: [src/services/referralService.ts](./src/services/referralService.ts)

---

### 5. **UI Components** โ

#### ReferralSection Component
ูููู ูุชูุงูู ูุนุฑุถ:
- โ ููุฏ ุงูุฅุญุงูุฉ ุงููุฑูุฏ
- โ ุฑุงุจุท ุงูุฅุญุงูุฉ ูุงุจู ูููุณุฎ
- โ ุฒุฑ ุงููุณุฎ (Copy)
- โ ุฒุฑ ุงููุดุงุฑูุฉ (Share)
- โ ุฅุญุตุงุฆูุงุช ุงูุฅุญุงูุงุช (ุดุจูุฉ 2ร2)
- โ ูุงุฆูุฉ ุงูุฅุญุงูุงุช ุงูุฃุฎูุฑุฉ ูุน ุงูุญุงูุงุช
- โ ุญุงูุงุช ุงููุฑุงุบ (Empty State)
- โ ุญุงูุฉ ุงูุชุญููู (Loading State)
- โ ุงูุฑุณูู ุงููุชุญุฑูุฉ (Animations)

๐ **ุงูููู**: [src/components/referral-section.tsx](./src/components/referral-section.tsx)

---

### 6. **ุตูุญุฉ ุงูุจุฑููุงูู** โ

ุชู ุชุญุฏูุซ ุตูุญุฉ ุงููุณุชุฎุฏู ูุชุถููู:
- โ ุงุณุชูุฑุงุฏ ูููู `ReferralSection`
- โ ุฅุถุงูุฉ state ูู `referralStats` ู `referralLoading`
- โ `useEffect` ูุฌูุจ ุงูุจูุงูุงุช
- โ ุชูุฑูุฑ ุงูุจูุงูุงุช ูููููู
- โ ุฏูุฌ ุณูุณ ูุน ุงูุชุตููู ุงูููุฌูุฏ

๐ **ุงูููู**: [src/components/user-profile.tsx](./src/components/user-profile.tsx)

---

### 7. **Models & Types** โ

ุชู ุชุญุฏูุซ ุงูููุงุฐุฌ:
- โ ุชุญุฏูุซ ูุงุฌูุฉ `User` ุจุญููู ุงูุฅุญุงูุงุช
- โ ุชุญุฏูุซ ูุงุฌูุฉ `Referral` ุจุงูุญููู ุงููุงููุฉ
- โ ุฅุถุงูุฉ ุฃููุงุน ุงูุจูุงูุงุช ุงูุดุงููุฉ

๐ **ุงููููุงุช**:
- [src/models/User.ts](./src/models/User.ts)
- [src/types/referral.ts](./src/types/referral.ts)

---

### 8. **Configuration** โ

ุชู ุฅูุดุงุก ููู ุฅุนุฏุงุฏุงุช ุดุงูู ูุน:
- โ ุชุฎุตูุต ูููุฉ ุงูููุงูุขุช
- โ ุนุชุจุงุช ุงูููุงูุขุช ุงูุฅุถุงููุฉ
- โ ุดุฑูุท ุงูููุงูุขุช
- โ ุญุฏูุฏ ุงูุงุณุชุฎุฏุงู (Rate Limiting)
- โ ุงูุฑุณุงุฆู ูุชุนุฏุฏุฉ ุงููุบุงุช

๐ **ุงูููู**: [src/config/referralConfig.ts](./src/config/referralConfig.ts)

---

### 9. **Middleware** โ

ุชู ุฅูุดุงุก middleware ูููุตุงุฏูุฉ:
- โ `isAuthenticated()` - ุงูุชุญูู ูู ุงููุณุชุฎุฏู
- โ `isAdmin()` - ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุฅุฏุงุฑุฉ

๐ **ุงูููู**: [api/middleware/auth.ts](./api/middleware/auth.ts)

---

### 10. **Authentication Integration** โ

ุชู ุชุญุฏูุซ ูุณุงุฑุงุช ุงููุตุงุฏูุฉ:
- โ ูุนุงูุฌุฉ ููุฏ ุงูุฅุญุงูุฉ ูู Google Callback
- โ ุญูุธ ุงูููุฏ ูู session
- โ ุชูุฌูู ูุน ุงูููุฏ ุฅูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

๐ **ุงูููู**: [api/routes/auth.ts](./api/routes/auth.ts)

---

### 11. **Integration Utilities** โ

ุชู ุฅูุดุงุก ููู ูุณุงุนุฏุงุช ููุชูุงูู ูุน:
- โ ูุนุงูุฌ ุงูุชุณุฌูู ูุน ุงูุฅุญุงูุงุช
- โ ุฅุดุนุงุฑุงุช ุงูููุญูู
- โ ุดุงุดุฉ ุงูุชุฑุญูุจ
- โ ุฃูุซูุฉ ุนูููุฉ

๐ **ุงูููู**: [src/utils/referralIntegration.ts](./src/utils/referralIntegration.ts)

---

### 12. **Server Configuration** โ

ุชู ุชุญุฏูุซ ุงูููู ุงูุฑุฆูุณู ููู backend:
- โ ุงุณุชูุฑุงุฏ ูุณุงุฑุงุช ุงูุฅุญุงูุงุช
- โ ุงุณุชูุฑุงุฏ ูุณุงุฑุงุช ุงููุตุงุฏูุฉ
- โ ุชุณุฌูู ุงููุณุงุฑุงุช ูู ุงูุชุทุจูู
- โ endpoint ุตุญุฉ ุงูุชุทุจูู (health check)

๐ **ุงูููู**: [api/server.ts](./api/server.ts)

---

### 13. **Tests** โ

ุชู ุฅูุดุงุก ููู ุงุฎุชุจุงุฑุงุช ุดุงูู ูุน:
- โ ุงุฎุชุจุงุฑุงุช ุชูููุฏ ุงูุฃููุงุฏ
- โ ุงุฎุชุจุงุฑุงุช ุงูุชุญูู ูู ุงูุตุญุฉ
- โ ุงุฎุชุจุงุฑุงุช ููุน ุงูุงุญุชูุงู
- โ ุงุฎุชุจุงุฑุงุช ุงูููุงูุขุช
- โ ุงุฎุชุจุงุฑุงุช ุงูุชุฏูู ุงููุงูู

๐ **ุงูููู**: [tests/referralSystem.test.ts](./tests/referralSystem.test.ts)

---

### 14. **Documentation** โ

ุชู ุฅูุดุงุก 3 ูููุงุช ุชูุซูู ุดุงููุฉ:

#### ุฃ) ุฏููู ุงููุธุงู ุงููุงูู
- ุดุฑุญ ูุนูุงุฑู
- API documentation
- ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู
- ูุตุงุฆุญ ุงูุฃูุงู

๐ **ุงูููู**: [REFERRAL_SYSTEM.md](./REFERRAL_SYSTEM.md)

#### ุจ) ุฏููู ุงูุจุฏุก ุงูุณุฑูุน
- ูุธุฑุฉ ุนุงูุฉ ุณุฑูุนุฉ
- ุฎุทูุงุช ุงูุชุซุจูุช
- ุฃูุซูุฉ ุนูููุฉ
- ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

๐ **ุงูููู**: [REFERRAL_QUICK_START.md](./REFERRAL_QUICK_START.md)

#### ุฌ) ููุฎุต ุงูุชูููุฐ (ูุฐุง ุงูููู)
- ูุงุฆูุฉ ุงูุชูุฌุฒุงุช
- ูููู ุงููููุงุช
- ููุงุญุธุงุช ุงูุฃูุงู
- ุงูุฎุทูุงุช ุงูุชุงููุฉ

๐ **ุงูููู**: [IMPLEMENTATION_SUMMARY.md](./IMPLEMENTATION_SUMMARY.md)

---

## ๐ ูููู ุงููุดุฑูุน (ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ)

```
Project-TWTC/
โโโ api/
โ   โโโ routes/
โ   โ   โโโ referral.ts (โจ ุฌุฏูุฏ)
โ   โ   โโโ auth.ts (๐ ูุญุฏูุซ)
โ   โโโ services/
โ   โ   โโโ referralBackendService.ts (โจ ุฌุฏูุฏ)
โ   โโโ middleware/
โ   โ   โโโ auth.ts (โจ ุฌุฏูุฏ)
โ   โโโ server.ts (๐ ูุญุฏูุซ)
โ
โโโ src/
โ   โโโ components/
โ   โ   โโโ referral-section.tsx (โจ ุฌุฏูุฏ)
โ   โ   โโโ user-profile.tsx (๐ ูุญุฏูุซ)
โ   โโโ services/
โ   โ   โโโ referralService.ts (๐ ูุญุฏูุซ)
โ   โโโ models/
โ   โ   โโโ User.ts (๐ ูุญุฏูุซ)
โ   โโโ config/
โ   โ   โโโ referralConfig.ts (โจ ุฌุฏูุฏ)
โ   โโโ types/
โ   โ   โโโ referral.ts (โจ ุฌุฏูุฏ)
โ   โโโ utils/
โ   โ   โโโ referralIntegration.ts (โจ ุฌุฏูุฏ)
โ   โโโ lib/
โ       โโโ schema.ts (๐ ูุญุฏูุซ)
โ
โโโ tests/
โ   โโโ referralSystem.test.ts (โจ ุฌุฏูุฏ)
โ
โโโ REFERRAL_SYSTEM.md (โจ ุฌุฏูุฏ)
โโโ REFERRAL_QUICK_START.md (โจ ุฌุฏูุฏ)
โโโ IMPLEMENTATION_SUMMARY.md (โจ ุฌุฏูุฏ)
```

---

## ๐ ููุฒุงุช ุงูุฃูุงู ุงููุถููุฉ

### โ ููุน ุงูุงุญุชูุงูุงุช

```typescript
// 1. ููุน ุฅุญุงูุฉ ุงูููุณ
if (referrerId === referredUserId) return false;

// 2. ููุน ุงูุฅุญุงูุงุช ุงูููุฑุฑุฉ
if (existingReferrals.includes({ referrerId, referredUserId })) return false;

// 3. ููุน ุงูููุงูุขุช ุงููุชูุฑุฑุฉ
if (referral.reward_given === true) return false;

// 4. ูุตุงุฏูุฉ ุฅุฌุจุงุฑูุฉ ุนูู ุงูู endpoints ุงูุญุณุงุณุฉ
@isAuthenticated middleware
```

### โ ุญูุงูุฉ ุงูุจูุงูุงุช

```typescript
// 1. ุงูุชุญูู ูู ุตูุบุฉ ุงูููุฏ
const codeRegex = /^[A-Z]{3}-[A-Z0-9]{6}$/;

// 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงููุฉ
try-catch ุนูู ุฌููุน ุงูุนูููุงุช

// 3. CORS ูุญุฏุฏ
origin: "https://twtc-mining.vercel.app"

// 4. Session ุขููุฉ
secure: true, sameSite: "none"
```

### โ Rate Limiting (ุฌุงูุฒ ููุฅุถุงูุฉ)

```typescript
// ูู referralConfig.ts
MAX_REFERRALS_PER_HOUR: 100,
MAX_REFERRALS_PER_DAY: 500,
MAX_TOTAL_REFERRALS: 0
```

---

## ๐ ุงููุชุทูุจุงุช ุงููุณุชูููุฉ

### โ ูู ุงููุชุทูุจุงุช ุงูุฃุตููุฉ:

- [x] ุตูุญุฉ ุงูุจุฑููุงูู โ Referral Section
  - [x] Referral Code ูุฑูุฏ
  - [x] Referral Link ูุงุจู ูููุณุฎ
  - [x] ุฒุฑ Copy Link
  - [x] ุฒุฑ Share

- [x] ููุทู ุงูุฅุญุงูุฉ
  - [x] ุฑุจุท ุชููุงุฆู ุจุงูููุญูู
  - [x] ุชุฎุฒูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - [x] ููุน ุฅุญุงูุฉ ุงูููุณ
  - [x] ููุน ุงูุชูุฑุงุฑ

- [x] ุชุชุจุน ุงูุฅุญุงูุงุช
  - [x] ุนุฏุฏ ุงูุฅุญุงูุงุช ุงูููู
  - [x] ุนุฏุฏ ุงูุฅุญุงูุงุช ุงูููุนููุฉ
  - [x] ุชุงุฑูุฎ ุงูุฅุญุงูุฉ
  - [x] ุญุงูุฉ ุงูุฅุญุงูุฉ

- [x] ูุธุงู ุงูููุงูุขุช
  - [x] ุดุฑูุท ุงูููุงูุฃุฉ
  - [x] ุฅุถุงูุฉ ุงูููุงูุขุช
  - [x] ููุน ุงูุชูุฑุงุฑ

- [x] ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - [x] ุฌุฏูู users ูุญุฏูุซ
  - [x] ุฌุฏูู referrals ุฌุฏูุฏ

- [x] ุงูุฃูุงู
  - [x] ุงูุชุญูู ูู ุงูุฃููุงุฏ
  - [x] ุญูุงูุฉ API
  - [x] ูุตุงุฏูุฉ ูุทููุจุฉ
  - [x] ููุน ุงูุงุญุชูุงูุงุช

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (Optional)

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# ุฅูุดุงุก ุงูุฌุฏุงูู ูู PostgreSQL
npm run migrate
```

### 2. ุงูุงุฎุชุจุงุฑ
```bash
# ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
npm run test referralSystem

# ุงุฎุชุจุงุฑ API
curl http://localhost:3000/api/referral/me
```

### 3. ุงูุชุฎุตูุต (ุงุฎุชูุงุฑู)
```typescript
// ุชุบููุฑ ุงูููุงูุขุช ูู referralConfig.ts
REFERRAL_REWARD: 100, // ูู 50 ุฅูู 100
```

### 4. ุงููุฑุงูุจุฉ (ุงุฎุชูุงุฑู)
```typescript
// ุฅุถุงูุฉ logging
LOG_REFERRALS: true,

// ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช
SEND_NOTIFICATIONS: true,
SEND_EMAILS: true,
```

### 5. ุงูุชูุณุนุงุช ุงููุณุชูุจููุฉ
- [ ] ูุธุงู ุงูููุฏุฑุจูุฑุฏ
- [ ] ุงูุฅุญุงูุงุช ูุชุนุฏุฏุฉ ุงููุณุชููุงุช
- [ ] ุชุตููุฉ ุงูุงุญุชูุงู ุจู AI
- [ ] ุชูุงูู Web3
- [ ] NFT ููููุงูุขุช

---

## ๐ฏ ุงูููุงุญุธุงุช ุงููููุฉ

### ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ
- ููุฏ ุงูุฅุญุงูุฉ: `ABC-1X2Y3` (3 ุฃุญุฑู ูุจูุฑุฉ + 3 ุฃุญุฑู/ุฃุฑูุงู)
- ุงูููุงูุฃุฉ ุงูุงูุชุฑุงุถูุฉ: 50 Coins
- ูุชุฑุฉ ุงูุชุฃููุฏ: 30 ููู
- ุงูุญุฏ ุงูุฃูุตู ููุฅุญุงูุงุช/ุณุงุนุฉ: 100

### ุงูุชูุงูู
- โ ูุชูุงูู ูุน Vite + React
- โ ูุชูุงูู ูุน Express Backend
- โ ูุชูุงูู ูุน MongoDB
- โ ูุชูุงูู ูุน PostgreSQL
- โ ุฌุงูุฒ ูููุดุฑ ุนูู Vercel

### ุงูุฃุฏุงุก
- โ Lazy loading ูููููู
- โ Caching ููุฅุญุตุงุฆูุงุช
- โ ุงุณุชุนูุงูุงุช ูุญุณููุฉ
- โ Pagination ููููุงุฆู ุงูุทูููุฉ (ูููู ุฅุถุงูุชูุง)

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ูููุฒูุฏ ูู ุงููุนูููุงุช ุงุทูุน ุนูู:

1. **[REFERRAL_SYSTEM.md](./REFERRAL_SYSTEM.md)** - ุฏููู ุดุงูู
2. **[REFERRAL_QUICK_START.md](./REFERRAL_QUICK_START.md)** - ุจุฏุก ุณุฑูุน
3. **[src/config/referralConfig.ts](./src/config/referralConfig.ts)** - ุงูุฅุนุฏุงุฏุงุช
4. **[tests/referralSystem.test.ts](./tests/referralSystem.test.ts)** - ุงูุงุฎุชุจุงุฑุงุช

---

## โจ ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ ูุธุงู ุฅุญุงูุงุช **ูุชูุงูู ูุขูู ููุงุจู ููุชูุณุน** ูุชุถูู:

- โ Backend API ูุชูุงูู
- โ Frontend components ุฌููู
- โ ุฎุฏูุงุช ูุนูุงุฑูุฉ
- โ ุญูุงูุฉ ูู ุงูุงุญุชูุงูุงุช
- โ ุชูุซูู ุดุงูู
- โ ุงุฎุชุจุงุฑุงุช ูุงููุฉ
- โ ุฅุนุฏุงุฏุงุช ูุฑูุฉ

ุงููุธุงู **ุฌุงูุฒ ููุฅูุชุงุฌ** ููุฏุนู **ุงูููู ุงูุนุถูู** ููุชุทุจูู! ๐

---

**ุชู ุงูุงูุชูุงุก: 2026-02-04** โจ
